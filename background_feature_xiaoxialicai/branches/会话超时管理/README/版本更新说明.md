# 会话超时问题解决方案

## 更新内容

- session表过期会话删除有问题，session表会越来越大
- app用户登入后，中间哪怕连续登入，7天后仍会提示过期
- 顺带补了一个日志记录项（增加记录deviceId）

## 解决

- 定时任务脚本定时删除过期会话（10天没登入过的）
- 用户在会话有效期内登入，同时超过1/4总有效期的话，重置过期时间（举例：假设4天过期，那么第一天内登入不会改过期时间，从第2天起，任何一天登入，都会重置过期时间为4天）
- 用户在会话有效期内登入，同时超过1/4总有效期的话，刷新oauth中的access_token和refresh_token  

## 数据库变更

- 无

## 配置文件变更

- 无

## 定时任务

- 有，但不需要改crontab
